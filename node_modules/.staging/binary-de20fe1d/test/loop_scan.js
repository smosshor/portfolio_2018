var binary = require('../');
var test = require('tap').test;
var EventEmitter = require('events').EventEmitter;

test('loop scan', function (t) {
    t.plan(8 + 6 + 2);
    
    var em = new EventEmitter;
    
    binary.stream(em)
        .loop(function (end) {
            var vars_ = this.vars;
            this
                .scan('filler', 'BEGINMSG')
                .buffer('cmd', 3)
                .word8('num')
                .tap(function (vars) {
                    t.strictEqual(vars, vars_);
  